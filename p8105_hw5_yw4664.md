p8105_hw5_yw4664
================
Yijun Wang
2025-11-01

## Problem 1

### Loading Libraries

``` r
library(tidyverse)

library(ggplot2)

set.seed(1) 

source("birthday_functions.R")
```

### Run this function 10000 times for each group size between 2 and 50, compute probability

``` r
n_range <- 2:50
B <- 10000

sim_results <- tibble(n = n_range) |>
  mutate(
    prob_dup = map_dbl(n, ~ mean(replicate(B, bday_collision(.x))))
  )
```

### Make a plot showing the probability as a function of group size

``` r
sim_results |>
  ggplot(aes(x = n, y = prob_dup)) +
  geom_line(size = 1) +
  geom_point(size = 1.2) +
  geom_hline(yintercept = 0.5, linetype = 2) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  labs(
    title = "Probability of â‰¥2 people sharing a birthday, 10,000 sims",
    x = "Group size",
    y = "Estimated probability"
  ) +
  theme_minimal(base_size = 14)
```

    ## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
    ## â„¹ Please use `linewidth` instead.
    ## This warning is displayed once every 8 hours.
    ## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
    ## generated.

![](p8105_hw5_yw4664_files/figure-gfm/unnamed-chunk-3-1.png)<!-- -->

The curve starts very close to 0 for small groups, meaning birthday
collisions are very unlikely.

The probability rises sharply between roughly 15 and 30 people, crossing
the 50 % line around n â‰ˆ 23, which is the famous birthday paradox point.

Beyond about 45 people, the probability approaches 1, implying that in
any moderately large group, shared birthdays are almost certain.

## Problem 2

### Loading Libraries

``` r
library(tidyverse)

library(ggplot2)

library(broom)

set.seed(1)

source("power_functions.R")
```

### Simulate 5000 datasets for mu = 0,1,2,3,4,5,6

``` r
mu_grid <- 0:6
B <- 5000

sim_p2 <- map_dfr(mu_grid, ~ bind_rows(replicate(B, power_one_run(.x), simplify = FALSE)))
```

### Plot showing the proportion of times the null was rejected on the y axis and the true value of ðœ‡ on the x axis

``` r
sim_p2 %>%
  group_by(mu_true) |>
  summarise(power = mean(reject), .groups = "drop") |>
  ggplot(aes(mu_true, power)) +
  geom_line(size = 1) + geom_point(size = 1.3) +
  scale_y_continuous(labels = scales::percent_format()) +
  labs(title = "Power vs True Î¼ (n=30, Ïƒ=5, Î±=0.05)", x = "True Î¼", y = "Power") +
  theme_minimal(base_size = 13)
```

![](p8105_hw5_yw4664_files/figure-gfm/unnamed-chunk-6-1.png)<!-- -->

### Plot showing the average estimate of ðœ‡Ì‚ on the y axis and the true value of ðœ‡ on the x axis and the average estimate of ðœ‡Ì‚ only in samples for which the null was rejected on the y axis and the true value of ðœ‡ on the x axis.

``` r
sim_p2 |>
  group_by(mu_true) |>
  summarise(
    muhat_overall = mean(mu_hat),
    muhat_condrej = mean(mu_hat[reject]),
    .groups = "drop"
  ) |>
  pivot_longer(-mu_true, names_to = "type", values_to = "avg_muhat") |>
  mutate(type = recode(type,
                       muhat_overall = "E[Î¼Ì‚]",
                       muhat_condrej = "E[Î¼Ì‚|reject]")) |>
  ggplot(aes(mu_true, avg_muhat, color = type)) +
  geom_line(size = 1) + geom_point(size = 1.3) +
  labs(title = "Average Î¼Ì‚ (all vs rejection)",
       x = "True Î¼", y = "Average Î¼Ì‚", color = NULL) +
  theme_minimal(base_size = 13)
```

![](p8105_hw5_yw4664_files/figure-gfm/unnamed-chunk-7-1.png)<!-- -->

No, the sample average of Î¼Ì‚ across tests for which the null was rejected
is not equal to the true Î¼, when Î¼ is small.

This happens because only samples with unusually large Î¼Ì‚ are likely to
be significant when the true effect is small.
